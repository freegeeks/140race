<!doctype html>
<html lang="en">
<head>
   <title>140 Race</title>
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta charset="utf-8">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<div class="base">

<div class="wrap_body">
<div class="header">
	<div class="userInfo user1">
		<span class="username">#re2005</span>
		<span class="speed p1">0</span>
		<span class="score">0</span>
	</div>
	<div id="timer" class="counter">140</div>
	<div class="userInfo user2">
		<span class="username">#edse</span>
		<span class="speed p2">0</span>
		<span class="score">0</span>
	</div>
</div>
<section>
	<div class="track-wrap">
		<div class="twitter">
			<p>Renatexx</p>
		</div>
		<div class="player_1"></div>
		<div class="player_2"></div>
		<div class="track"></div>	
    <div class="tweets"></div>
	</div>
</section>
</div>

  <script src="js/jquery.min.js"></script>
  <script src="js/140race.js"></script>
  <script>
  function startGame(startTime) {
    moveTrack(-1928);
    trackTime(startTime, 140);
  }

  function trackTime(startTime, totalTime) {
    var difference = ((new Date()).getTime() - startTime) / 1000;
    var timeLeft = Math.ceil(totalTime - difference);
    if (timeLeft >= 0) {
      $('#timer').html(timeLeft);

      setTimeout(function() {
        trackTime(startTime, totalTime);
      }, 1000 / 60);
    }
  }

  var hashtag = location.pathname.substring(1);

  var socket = io.connect('http://localhost', 8888);
  socket.on('connect', function () {
    socket.emit('gimmetweets', { hashtag: hashtag });
  });

  socket.on('tweet', function (data) {
    var tweet = $('<p />').text(data.text);
    $('.tweets').append(tweet);
    $('.tweets').css('margin-top', 600 - $('.tweets').height());
  });

  socket.on('score', function (data) {
    $('.user1 .score').html(parseInt(data.score));
    $('.user2 .score').html(parseInt(data.o_score));
    
    var playerOneTop = parseInt($('.player_1').css('top'), 10);
    var playerTwoTop = parseInt($('.player_2').css('top'), 10);
    $('.player_1').css('top', playerOneTop - data.score);
    $('.player_2').css('top', playerTwoTop - data.o_score);
  });
  </script>
  </body>
</html>
